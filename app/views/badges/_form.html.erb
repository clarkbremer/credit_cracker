<%= form_with(model: badge, local: true) do |form| %>
  <% if badge.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(badge.errors.count, "error") %> prohibited this badge from being saved:</h2>

      <ul>
      <% badge.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name, id: :badge_name %>
  </div>

  <div class="field">
    <%= form.label :version %>
    <%= form.number_field :version, id: :badge_version %>
  </div>

  <div>
    <table id='standards_form_table' class='dtable cell-border table table-bordered' cellspacing='0' width='100%'>
      <thead>
        <tr>
          <th>Select</th>
          <th>Subject</th>
          <th>Code</th>
          <th>Benchmark</th>
          <th>Example</th>
        </tr>
      </thead>

      <tbody>
        <% Standard.find_each do |standard| %>
          <tr>
            <td><%= check_box_tag "badge[standard_ids][]", standard.id, @badge.standards.include?(standard) %></td>
            <td><%= standard.subject %></td>
            <td><%= standard.code %></td>
            <td class="small"><%= standard.benchmark %></td>
            <td class="small"><%= standard.example %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

  </div>

  <div class="actions">
    <%= form.submit id: 'btn-submit' %>
  </div>
<% end %>

<script type="text/javascript">
$(document).ready(function(){
  var table = $('#standards_form_table').DataTable({
    select: {
      style: 'multi',
    },
    order: [[ 0, "asc" ], [1, "asc"], [2, "asc"]],
    columnDefs: [
      { targets: [3,4], orderable: false},
    ]
  });

  table.rows().every( function(rowIndex) {
    var $checkbox = $(table.row(rowIndex).node()).find('td:first-child input[type="checkbox"]');
    if($checkbox.is(':checked')) {
      this.select();
    } else {
      this.deselect();
    }
  });

  table.on( 'select', function ( e, dt, type, indexes ) {
   if ( type === 'row' ) {
      var $checkbox = $(table.row( indexes[0] ).node()).find('td:first-child input[type="checkbox"]');
      $checkbox.prop('checked', true);
    }
  });

  table.on( 'deselect', function ( e, dt, type, indexes ) {
   if ( type === 'row' ) {
      var $checkbox = $(table.row( indexes[0] ).node()).find('td:first-child input[type="checkbox"]');
      $checkbox.prop('checked', false);
    }
  });

});
</script>
